// Untitled198.ipynb from Aaron's cornerCoords_SN-C1-reordered.fits table
var decam_rds = [
[ [ -0.45920, 0.97905],[-0.45942, 0.82986],[-0.16033, 0.82926],[-0.16019, 0.97832],[-0.45920, 0.97905 ], ],
    [ [ -0.14890, 0.97826],[-0.14931, 0.82920],[0.14998, 0.82855],[0.15021, 0.97761],[-0.14890, 0.97826 ], ],
    [ [ 0.16164, 0.97830],[0.16166, 0.82924],[0.46074, 0.82956],[0.46066, 0.97876],[0.16164, 0.97830 ], ],
    [ [ -0.61452, 0.81569],[-0.61483, 0.66644],[-0.31585, 0.66555],[-0.31557, 0.81475],[-0.61452, 0.81569 ], ],
    [ [ -0.30426, 0.81477],[-0.30445, 0.66560],[-0.00501, 0.66538],[-0.00500, 0.81456],[-0.30426, 0.81477 ], ],
    [ [ 0.00637, 0.81453],[0.00626, 0.66535],[0.30570, 0.66534],[0.30561, 0.81452],[0.00637, 0.81453 ], ],
    [ [ 0.31682, 0.81455],[0.31697, 0.66537],[0.61596, 0.66602],[0.61574, 0.81527],[0.31682, 0.81455 ], ],
    [ [ -0.76975, 0.65225],[-0.77000, 0.50289],[-0.47127, 0.50175],[-0.47103, 0.65112],[-0.76975, 0.65225 ], ],
    [ [ -0.45970, 0.65125],[-0.46009, 0.50189],[-0.16069, 0.50110],[-0.16046, 0.65052],[-0.45970, 0.65125 ], ],
    [ [ -0.14919, 0.65049],[-0.14933, 0.50108],[0.15039, 0.50099],[0.15035, 0.65039],[-0.14919, 0.65049 ], ],
    [ [ 0.16160, 0.65050],[0.16161, 0.50108],[0.46103, 0.50141],[0.46086, 0.65077],[0.16160, 0.65050 ], ],
    [ [ 0.47220, 0.65078],[0.47238, 0.50140],[0.77115, 0.50233],[0.77097, 0.65169],[0.47220, 0.65078 ], ],
    [ [ -0.92499, 0.48907],[-0.92522, 0.33964],[-0.62677, 0.33783],[-0.62642, 0.48735],[-0.92499, 0.48907 ], ],
    [ [ -0.61531, 0.48753],[-0.61562, 0.33802],[-0.31646, 0.33697],[-0.31624, 0.48658],[-0.61531, 0.48753 ], ],
    [ [ -0.30483, 0.48667],[-0.30502, 0.33703],[-0.00523, 0.33667],[-0.00518, 0.48633],[-0.30483, 0.48667 ], ],
    [ [ 0.00615, 0.48608],[0.00613, 0.33640],[0.30592, 0.33665],[0.30580, 0.48628],[0.00615, 0.48608 ], ],
    [ [ 0.31719, 0.48648],[0.31722, 0.33685],[0.61639, 0.33753],[0.61628, 0.48705],[0.31719, 0.48648 ], ],
    [ [ 0.62771, 0.48699],[0.62793, 0.33748],[0.92636, 0.33915],[0.92622, 0.48858],[0.62771, 0.48699 ], ],
    [ [ -0.92511, 0.32506],[-0.92527, 0.17559],[-0.62687, 0.17365],[-0.62668, 0.32331],[-0.92511, 0.32506 ], ],
    [ [ -0.61557, 0.32310],[-0.61582, 0.17344],[-0.31658, 0.17219],[-0.31641, 0.32200],[-0.61557, 0.32310 ], ],
    [ [ -0.30509, 0.32217],[-0.30522, 0.17238],[-0.00533, 0.17192],[-0.00528, 0.32179],[-0.30509, 0.32217 ], ],
    [ [ 0.00613, 0.32189],[0.00603, 0.17202],[0.30591, 0.17216],[0.30593, 0.32196],[0.00613, 0.32189 ], ],
    [ [ 0.31747, 0.32198],[0.31748, 0.17218],[0.61671, 0.17309],[0.61664, 0.32274],[0.31747, 0.32198 ], ],
    [ [ 0.62784, 0.32277],[0.62791, 0.17311],[0.92629, 0.17481],[0.92627, 0.32435],[0.62784, 0.32277 ], ],
    [ [ -1.08035, 0.16192],[-1.08040, 0.01245],[-0.78210, 0.00992],[-0.78203, 0.15954],[-1.08035, 0.16192 ], ],
    [ [ -0.77072, 0.15965],[-0.77083, 0.01002],[-0.47205, 0.00825],[-0.47194, 0.15807],[-0.77072, 0.15965 ], ],
    [ [ -0.46056, 0.15788],[-0.46069, 0.00805],[-0.16102, 0.00706],[-0.16092, 0.15700],[-0.46056, 0.15788 ], ],
    [ [ -0.14938, 0.15712],[-0.14941, 0.00717],[0.15061, 0.00715],[0.15061, 0.15711],[-0.14938, 0.15712 ], ],
    [ [ 0.16175, 0.15688],[0.16173, 0.00693],[0.46138, 0.00772],[0.46136, 0.15755],[0.16175, 0.15688 ], ],
    [ [ 0.47294, 0.15757],[0.47295, 0.00776],[0.77175, 0.00934],[0.77172, 0.15898],[0.47294, 0.15757 ], ],
    [ [ 0.78288, 0.15914],[0.78293, 0.00951],[1.08118, 0.01197],[1.08117, 0.16145],[0.78288, 0.15914 ], ],
    [ [ -1.08051, -0.00221],[-1.08062, -0.15168],[-0.78229, -0.15458],[-0.78222, -0.00496],[-1.08051, -0.00221 ], ],
    [ [ -0.77090, -0.00489],[-0.77092, -0.15452],[-0.47215, -0.15653],[-0.47212, -0.00671],[-0.77090, -0.00489 ], ],
    [ [ -0.46081, -0.00680],[-0.46076, -0.15662],[-0.16114, -0.15760],[-0.16114, -0.00767],[-0.46081, -0.00680 ], ],
    [ [ -0.14973, -0.00771],[-0.14978, -0.15765],[0.15021, -0.15775],[0.15028, -0.00781],[-0.14973, -0.00771 ], ],
    [ [ 0.16141, -0.00798],[0.16146, -0.15793],[0.46109, -0.15683],[0.46107, -0.00701],[0.16141, -0.00798 ], ],
    [ [ 0.47258, -0.00693],[0.47247, -0.15680],[0.77124, -0.15501],[0.77134, -0.00541],[0.47258, -0.00693 ], ],
    [ [ 0.78279, -0.00540],[0.78263, -0.15503],[1.08092, -0.15257],[1.08103, -0.00311],[0.78279, -0.00540 ], ],
    [ [ -0.92571, -0.16812],[-0.92560, -0.31760],[-0.62719, -0.32007],[-0.62733, -0.17043],[-0.92571, -0.16812 ], ],
    [ [ -0.61609, -0.17058],[-0.61594, -0.32023],[-0.31677, -0.32182],[-0.31685, -0.17203],[-0.61609, -0.17058 ], ],
    [ [ -0.30535, -0.17203],[-0.30526, -0.32183],[-0.00546, -0.32238],[-0.00545, -0.17251],[-0.30535, -0.17203 ], ],
    [ [ 0.00599, -0.17273],[0.00593, -0.32257],[0.30574, -0.32209],[0.30586, -0.17229],[0.00599, -0.17273 ], ],
    [ [ 0.31721, -0.17229],[0.31708, -0.32209],[0.61624, -0.32060],[0.61642, -0.17095],[0.31721, -0.17229 ], ],
    [ [ 0.62766, -0.17093],[0.62742, -0.32060],[0.92587, -0.31820],[0.92603, -0.16874],[0.62766, -0.17093 ], ],
    [ [ -0.92568, -0.33228],[-0.92551, -0.48171],[-0.62701, -0.48423],[-0.62725, -0.33471],[-0.92568, -0.33228 ], ],
    [ [ -0.61620, -0.33497],[-0.61596, -0.48448],[-0.31691, -0.48617],[-0.31702, -0.33654],[-0.61620, -0.33497 ], ],
    [ [ -0.30532, -0.33665],[-0.30529, -0.48627],[-0.00565, -0.48704],[-0.00552, -0.33739],[-0.30532, -0.33665 ], ],
    [ [ 0.00557, -0.33746],[0.00555, -0.48717],[0.30521, -0.48654],[0.30538, -0.33684],[0.00557, -0.33746 ], ],
    [ [ 0.31703, -0.33683],[0.31682, -0.48646],[0.61590, -0.48489],[0.61620, -0.33538],[0.31703, -0.33683 ], ],
    [ [ 0.62745, -0.33525],[0.62719, -0.48474],[0.92568, -0.48229],[0.92589, -0.33285],[0.62745, -0.33525 ], ],
    [ [ -0.77053, -0.49796],[-0.77039, -0.64731],[-0.47166, -0.64969],[-0.47181, -0.50032],[-0.77053, -0.49796 ], ],
    [ [ -0.46055, -0.50025],[-0.46036, -0.64962],[-0.16113, -0.65089],[-0.16118, -0.50150],[-0.46055, -0.50025 ], ],
    [ [ -0.14968, -0.50146],[-0.14964, -0.65087],[0.14989, -0.65100],[0.15006, -0.50159],[-0.14968, -0.50146 ], ],
    [ [ 0.16131, -0.50174],[0.16111, -0.65115],[0.46031, -0.65015],[0.46069, -0.50077],[0.16131, -0.50174 ], ],
    [ [ 0.47199, -0.50057],[0.47168, -0.64992],[0.77041, -0.64783],[0.77070, -0.49848],[0.47199, -0.50057 ], ],
    [ [ -0.61537, -0.66335],[-0.61517, -0.81261],[-0.31628, -0.81441],[-0.31649, -0.66519],[-0.61537, -0.66335 ], ],
    [ [ -0.30527, -0.66522],[-0.30512, -0.81439],[-0.00586, -0.81513],[-0.00583, -0.66592],[-0.30527, -0.66522 ], ],
    [ [ 0.00563, -0.66608],[0.00566, -0.81526],[0.30490, -0.81455],[0.30506, -0.66537],[0.00563, -0.66608 ], ],
    [ [ 0.31632, -0.66540],[0.31612, -0.81459],[0.61504, -0.81292],[0.61531, -0.66368],[0.31632, -0.66540 ], ],
    [ [ -0.46006, -0.82837],[-0.46002, -0.97759],[-0.16106, -0.97892],[-0.16098, -0.82981],[-0.46006, -0.82837 ], ],
    [ [ -0.14966, -0.82964],[-0.14964, -0.97869],[0.14946, -0.97881],[0.14963, -0.82976],[-0.14966, -0.82964 ], ],
    [ [ 0.16100, -0.82983],[0.16083, -0.97889],[0.45984, -0.97803],[0.46012, -0.82884],[0.16100, -0.82983 ], ],
];

var decam_ccd_names = [ 'S29', 'S30', 'S31',
                        'S25', 'S26', 'S27', 'S28',
                        'S20', 'S21', 'S22', 'S23', 'S24',
                        'S14', 'S15', 'S16', 'S17', 'S18', 'S19',
                        'S8',  'S9',  'S10', 'S11', 'S12', 'S13',
                        'S1',  'S2',  'S3',  'S4',  'S5',  'S6',  'S7',
                        'N1',  'N2',  'N3',  'N4',  'N5',  'N6',  'N7',
                        'N8',  'N9',  'N10', 'N11', 'N12', 'N13',
                        'N14', 'N15', 'N16', 'N17', 'N18', 'N19',
                        'N20', 'N21', 'N22', 'N23', 'N24',
                        'N25', 'N26', 'N27', 'N28',
                        'N29', 'N30', 'N31',
                      ];
                        



var DecamOverlay = DesiOverlay.extend({
    initialize: function(name, pretty, kwargs) {
        DesiOverlay.prototype.initialize.call(this, name, pretty, kwargs);

        var group = [];
        var clong = 180;

        this._ccd_label_rds = [];
        this._ccd_labels = [];
        for (var i=0; i<decam_rds.length; i++) {
            var rd = decam_rds[i];
            var N = rd.length;
            var mean_ra = 0.;
            var mean_dec = 0.;
            for (var j=0; j<N; j++) {
                mean_ra += rd[j][0];
                mean_dec += rd[j][1];
            }
            dra  = mean_ra  / N;
            ddec = mean_dec / N;
            this._ccd_label_rds.push([dra,ddec]);

            var latlng = [dec2lat(ddec), ra2long_C(dra, clong)];
            var circ = L.circle(latlng, 0., {'color':'red', 'opacity':0.,
                                         'fillOpacity':0, 'weight':5});
            //ccd_name = 'CCD ' + (i+1);
            ccd_name = decam_ccd_names[i];
            circ.bindTooltip(ccd_name,
                             {interactive: true, permanent: true,
                              direction: 'center', className: 'gfa-label' });
            this._ccd_labels.push(circ);
            group.push(circ);
        }
        this._ccds = L.polyline([], {color: 'orange'});
        group.push(this._ccds);

        this._layer = L.layerGroup(group);
    },
    moveTo: function(c) {
        var clong = c.lng;
        var d0 = lat2dec(c.lat);
        var r0 = long2ra(clong);
        this.ra = r0;
        this.dec = d0;
        var cosdec = Math.cos(d0 * Math.PI / 180.0);
        var polys = [];
        var labels = [];
        console.log('Decam RDs:', decam_rds.length);
        for (var i=0; i<decam_rds.length; i++) {
            var ll = [];
            var rd = decam_rds[i];
            var N = rd.length;
            for (var j=0; j<N; j++) {
                ll.push([dec2lat(d0 + rd[j][1]),
                         ra2long_C(r0 + rd[j][0] / cosdec, clong)]);
            }
            polys.push(ll);
        }
        this._ccds.setLatLngs(polys);
        this._ccds.redraw();

        for (var i=0; i<this._ccd_label_rds.length; i++) {
            rd = this._ccd_label_rds[i];
            this._ccd_labels[i].setLatLng([dec2lat(d0 + rd[1]),
                                           ra2long_C(r0 + rd[0] / cosdec, clong)]);
        }

    },
});

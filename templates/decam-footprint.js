var decam_rds = [
    [ [ -0.51149, 0.97905],[-0.51239, 0.82986],[-0.17882, 0.82926],[-0.17843, 0.97832],[-0.51149, 0.97905 ], ],
    [ [ -0.16586, 0.97826],[-0.16653, 0.82920],[0.16727, 0.82855],[0.16732, 0.97761],[-0.16586, 0.97826 ], ],
    [ [ 0.18005, 0.97830],[0.18030, 0.82924],[0.51386, 0.82956],[0.51311, 0.97876],[0.18005, 0.97830 ], ],
    [ [ -0.68545, 0.81569],[-0.68668, 0.66644],[-0.35276, 0.66555],[-0.35200, 0.81475],[-0.68545, 0.81569 ], ],
    [ [ -0.33938, 0.81477],[-0.34003, 0.66560],[-0.00560, 0.66538],[-0.00558, 0.81456],[-0.33938, 0.81477 ], ],
    [ [ 0.00710, 0.81453],[0.00699, 0.66535],[0.34143, 0.66534],[0.34089, 0.81452],[0.00710, 0.81453 ], ],
    [ [ 0.35339, 0.81455],[0.35402, 0.66537],[0.68795, 0.66602],[0.68682, 0.81527],[0.35339, 0.81455 ], ],
    [ [ -0.85982, 0.65225],[-0.86121, 0.50289],[-0.52710, 0.50175],[-0.52615, 0.65112],[-0.85982, 0.65225 ], ],
    [ [ -0.51349, 0.65125],[-0.51460, 0.50189],[-0.17973, 0.50110],[-0.17924, 0.65052],[-0.51349, 0.65125 ], ],
    [ [ -0.16665, 0.65049],[-0.16702, 0.50108],[0.16821, 0.50099],[0.16794, 0.65039],[-0.16665, 0.65049 ], ],
    [ [ 0.18051, 0.65050],[0.18076, 0.50108],[0.51565, 0.50141],[0.51479, 0.65077],[0.18051, 0.65050 ], ],
    [ [ 0.52746, 0.65078],[0.52835, 0.50140],[0.86250, 0.50233],[0.86118, 0.65169],[0.52746, 0.65078 ], ],
    [ [ -1.03469, 0.48907],[-1.03631, 0.33964],[-0.70203, 0.33783],[-0.70072, 0.48735],[-1.03469, 0.48907 ], ],
    [ [ -0.68829, 0.48753],[-0.68954, 0.33802],[-0.35446, 0.33697],[-0.35375, 0.48658],[-0.68829, 0.48753 ], ],
    [ [ -0.34099, 0.48667],[-0.34165, 0.33703],[-0.00586, 0.33667],[-0.00580, 0.48633],[-0.34099, 0.48667 ], ],
    [ [ 0.00688, 0.48608],[0.00687, 0.33640],[0.34266, 0.33665],[0.34208, 0.48628],[0.00688, 0.48608 ], ],
    [ [ 0.35482, 0.48648],[0.35532, 0.33685],[0.69041, 0.33753],[0.68938, 0.48705],[0.35482, 0.48648 ], ],
    [ [ 0.70217, 0.48699],[0.70334, 0.33748],[1.03759, 0.33915],[1.03607, 0.48858],[0.70217, 0.48699 ], ],
    [ [ -1.03631, 0.32506],[-1.03786, 0.17559],[-0.70316, 0.17365],[-0.70202, 0.32331],[-1.03631, 0.32506 ], ],
    [ [ -0.68958, 0.32310],[-0.69077, 0.17344],[-0.35512, 0.17219],[-0.35445, 0.32200],[-0.68958, 0.32310 ], ],
    [ [ -0.34177, 0.32217],[-0.34237, 0.17238],[-0.00598, 0.17192],[-0.00592, 0.32179],[-0.34177, 0.32217 ], ],
    [ [ 0.00687, 0.32189],[0.00676, 0.17202],[0.34315, 0.17216],[0.34271, 0.32196],[0.00687, 0.32189 ], ],
    [ [ 0.35564, 0.32198],[0.35613, 0.17218],[0.69177, 0.17309],[0.69078, 0.32274],[0.35564, 0.32198 ], ],
    [ [ 0.70332, 0.32277],[0.70433, 0.17311],[1.03902, 0.17481],[1.03762, 0.32435],[0.70332, 0.32277 ], ],
    [ [ -1.21196, 0.16192],[-1.21363, 0.01245],[-0.87857, 0.00992],[-0.87732, 0.15954],[-1.21196, 0.16192 ], ],
    [ [ -0.86463, 0.15965],[-0.86591, 0.01002],[-0.53028, 0.00825],[-0.52945, 0.15807],[-0.86463, 0.15965 ], ],
    [ [ -0.51669, 0.15788],[-0.51752, 0.00805],[-0.18088, 0.00706],[-0.18053, 0.15700],[-0.51669, 0.15788 ], ],
    [ [ -0.16759, 0.15712],[-0.16784, 0.00717],[0.16919, 0.00715],[0.16896, 0.15711],[-0.16759, 0.15712 ], ],
    [ [ 0.18146, 0.15688],[0.18168, 0.00693],[0.51830, 0.00772],[0.51758, 0.15755],[0.18146, 0.15688 ], ],
    [ [ 0.53058, 0.15757],[0.53130, 0.00776],[0.86694, 0.00934],[0.86576, 0.15898],[0.53058, 0.15757 ], ],
    [ [ 0.87828, 0.15914],[0.87950, 0.00951],[1.21452, 0.01197],[1.21289, 0.16145],[0.87828, 0.15914 ], ],
    [ [ -1.21392, -0.00221],[-1.21567, -0.15168],[-0.88008, -0.15458],[-0.87882, -0.00496],[-1.21392, -0.00221 ], ],
    [ [ -0.86610, -0.00489],[-0.86728, -0.15452],[-0.53118, -0.15653],[-0.53043, -0.00671],[-0.86610, -0.00489 ], ],
    [ [ -0.51772, -0.00680],[-0.51837, -0.15662],[-0.18129, -0.15760],[-0.18104, -0.00767],[-0.51772, -0.00680 ], ],
    [ [ -0.16823, -0.00771],[-0.16851, -0.15765],[0.16899, -0.15775],[0.16884, -0.00781],[-0.16823, -0.00771 ], ],
    [ [ 0.18135, -0.00798],[0.18165, -0.15793],[0.51874, -0.15683],[0.51802, -0.00701],[0.18135, -0.00798 ], ],
    [ [ 0.53095, -0.00693],[0.53154, -0.15680],[0.86765, -0.15501],[0.86660, -0.00541],[0.53095, -0.00693 ], ],
    [ [ 0.87946, -0.00540],[0.88046, -0.15503],[1.21601, -0.15257],[1.21451, -0.00311],[0.87946, -0.00540 ], ],
    [ [ -1.04155, -0.16812],[-1.04283, -0.31760],[-0.70664, -0.32007],[-0.70585, -0.17043],[-1.04155, -0.16812 ], ],
    [ [ -0.69320, -0.17058],[-0.69397, -0.32023],[-0.35691, -0.32182],[-0.35651, -0.17203],[-0.69320, -0.17058 ], ],
    [ [ -0.34357, -0.17203],[-0.34394, -0.32183],[-0.00615, -0.32238],[-0.00613, -0.17251],[-0.34357, -0.17203 ], ],
    [ [ 0.00674, -0.17273],[0.00668, -0.32257],[0.34448, -0.32209],[0.34415, -0.17229],[0.00674, -0.17273 ], ],
    [ [ 0.35692, -0.17229],[0.35726, -0.32209],[0.69431, -0.32060],[0.69358, -0.17095],[0.35692, -0.17229 ], ],
    [ [ 0.70622, -0.17093],[0.70691, -0.32060],[1.04315, -0.31820],[1.04192, -0.16874],[0.70622, -0.17093 ], ],
    [ [ -1.04306, -0.33228],[-1.04429, -0.48171],[-0.70750, -0.48423],[-0.70681, -0.33471],[-1.04306, -0.33228 ], ],
    [ [ -0.69436, -0.33497],[-0.69503, -0.48448],[-0.35760, -0.48617],[-0.35724, -0.33654],[-0.69436, -0.33497 ], ],
    [ [ -0.34405, -0.33665],[-0.34448, -0.48627],[-0.00638, -0.48704],[-0.00622, -0.33739],[-0.34405, -0.33665 ], ],
    [ [ 0.00628, -0.33746],[0.00626, -0.48717],[0.34440, -0.48654],[0.34412, -0.33684],[0.00628, -0.33746 ], ],
    [ [ 0.35725, -0.33683],[0.35750, -0.48646],[0.69496, -0.48489],[0.69436, -0.33538],[0.35725, -0.33683 ], ],
    [ [ 0.70703, -0.33525],[0.70770, -0.48474],[1.04449, -0.48229],[1.04331, -0.33285],[0.70703, -0.33525 ], ],
    [ [ -0.86955, -0.49796],[-0.87058, -0.64731],[-0.53301, -0.64969],[-0.53245, -0.50032],[-0.86955, -0.49796 ], ],
    [ [ -0.51974, -0.50025],[-0.52024, -0.64962],[-0.18209, -0.65089],[-0.18190, -0.50150],[-0.51974, -0.50025 ], ],
    [ [ -0.16892, -0.50146],[-0.16911, -0.65087],[0.16939, -0.65100],[0.16935, -0.50159],[-0.16892, -0.50146 ], ],
    [ [ 0.18205, -0.50174],[0.18207, -0.65115],[0.52019, -0.65015],[0.51991, -0.50077],[0.18205, -0.50174 ], ],
    [ [ 0.53266, -0.50057],[0.53303, -0.64992],[0.87061, -0.64783],[0.86974, -0.49848],[0.53266, -0.50057 ], ],
    [ [ -0.69550, -0.66335],[-0.69623, -0.81261],[-0.35796, -0.81441],[-0.35771, -0.66519],[-0.69550, -0.66335 ], ],
    [ [ -0.34503, -0.66522],[-0.34533, -0.81439],[-0.00663, -0.81513],[-0.00659, -0.66592],[-0.34503, -0.66522 ], ],
    [ [ 0.00636, -0.66608],[0.00641, -0.81526],[0.34508, -0.81455],[0.34479, -0.66537],[0.00636, -0.66608 ], ],
    [ [ 0.35752, -0.66540],[0.35778, -0.81459],[0.69609, -0.81292],[0.69544, -0.66368],[0.35752, -0.66540 ], ],
    [ [ -0.52076, -0.82837],[-0.52144, -0.97759],[-0.18256, -0.97892],[-0.18222, -0.82981],[-0.52076, -0.82837 ], ],
    [ [ -0.16941, -0.82964],[-0.16962, -0.97869],[0.16942, -0.97881],[0.16937, -0.82976],[-0.16941, -0.82964 ], ],
    [ [ 0.18225, -0.82983],[0.18230, -0.97889],[0.52123, -0.97803],[0.52083, -0.82884],[0.18225, -0.82983 ], ],
];

var decam_ccd_names = [ 'S29', 'S30', 'S31',
                        'S25', 'S26', 'S27', 'S28',
                        'S20', 'S21', 'S22', 'S23', 'S24',
                        'S14', 'S15', 'S16', 'S17', 'S18', 'S19',
                        'S8',  'S9',  'S10', 'S11', 'S12', 'S13',
                        'S1',  'S2',  'S3',  'S4',  'S5',  'S6',  'S7',
                        'N1',  'N2',  'N3',  'N4',  'N5',  'N6',  'N7',
                        'N8',  'N9',  'N10', 'N11', 'N12', 'N13',
                        'N14', 'N15', 'N16', 'N17', 'N18', 'N19',
                        'N20', 'N21', 'N22', 'N23', 'N24',
                        'N25', 'N26', 'N27', 'N28',
                        'N29', 'N30', 'N31',
                      ];
                        



var DecamOverlay = DesiOverlay.extend({
    initialize: function(name, pretty, kwargs) {
        DesiOverlay.prototype.initialize.call(this, name, pretty, kwargs);

        var group = [];
        var clong = 180;

        this._ccd_label_rds = [];
        this._ccd_labels = [];
        for (var i=0; i<decam_rds.length; i++) {
            var rd = decam_rds[i];
            var N = rd.length;
            var mean_ra = 0.;
            var mean_dec = 0.;
            for (var j=0; j<N; j++) {
                mean_ra += rd[j][0];
                mean_dec += rd[j][1];
            }
            dra  = mean_ra  / N;
            ddec = mean_dec / N;
            this._ccd_label_rds.push([dra,ddec]);

            var latlng = [dec2lat(ddec), ra2long_C(dra, clong)];
            var circ = L.circle(latlng, 0., {'color':'red', 'opacity':0.,
                                         'fillOpacity':0, 'weight':5});
            //ccd_name = 'CCD ' + (i+1);
            ccd_name = decam_ccd_names[i];
            circ.bindTooltip(ccd_name,
                             {interactive: true, permanent: true,
                              direction: 'center', className: 'gfa-label' });
            this._ccd_labels.push(circ);
            group.push(circ);
        }
        this._ccds = L.polyline([], {color: 'orange'});
        group.push(this._ccds);

        this._layer = L.layerGroup(group);
    },
    moveTo: function(c) {
        var clong = c.lng;
        var d0 = lat2dec(c.lat);
        var r0 = long2ra(clong);
        this.ra = r0;
        this.dec = d0;
        var cosdec = Math.cos(d0 * Math.PI / 180.0);
        var polys = [];
        var labels = [];
        console.log('Decam RDs:', decam_rds.length);
        for (var i=0; i<decam_rds.length; i++) {
            var ll = [];
            var rd = decam_rds[i];
            var N = rd.length;
            for (var j=0; j<N; j++) {
                ll.push([dec2lat(d0 + rd[j][1]),
                         ra2long_C(r0 + rd[j][0] / cosdec, clong)]);
            }
            polys.push(ll);
        }
        this._ccds.setLatLngs(polys);
        this._ccds.redraw();

        for (var i=0; i<this._ccd_label_rds.length; i++) {
            rd = this._ccd_label_rds[i];
            this._ccd_labels[i].setLatLng([dec2lat(d0 + rd[1]),
                                           ra2long_C(r0 + rd[0] / cosdec, clong)]);
        }

    },
});
